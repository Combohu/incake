"use strict";require(["config"],function(){require(["jquery","tools","header","footer","template","cookie"],function(p,e,t,i,n,c){new Promise(function(e,t){p("header").load("/html/component/header.html",function(){e()}),p("footer").load("/html/component/footer.html")}).then(function(){t.nav(),t.localCity(),t.login(),t.exit()});p("#list_active");var f=p("#money"),m=0,o=p.cookie("cart"),r=e.$(".empty_basket")[0],a=JSON.parse(o);console.log(e.$(".item").length);var l=n("pro_template",{cookies:a});p("#list_active").html(l),e.$(".item").length?r.style.display="none":r.style.display="block";var s=!0,h=!1,d=void 0;try{for(var v,_=a[Symbol.iterator]();!(s=(v=_.next()).done);s=!0){var k=v.value;m+=k.price*k.num}}catch(e){h=!0,d=e}finally{try{s||null==_.return||_.return()}finally{if(h)throw d}}f.html(m);p(".btn_sub"),p(".btn_add");p("#list_active").on("click",".btn_sub",function(e){var t=p.cookie("cart"),i=JSON.parse(t);console.log(i);var n=p(this).siblings().children(":first"),c=n.parents(".c_amount").siblings(".c_product").find(".cn"),o=n.parents(".c_amount").siblings(".c_cheaper").find(".xiaoJi"),r=n.val();if(1<r){r--;for(var a=0;a<i.length;a++)if(i[a].name==c.html()){i[a].num=r,o.html(i[a].price*i[a].num),n.val(i[a].num);break}var l=JSON.stringify(i);p.cookie("cart",l);var s=p("#list_active").find(".item"),h=p("#list_active").find(".btn_ckBox");for(a=m=0;a<s.length;a++)h.eq(a).prop("checked")&&(m+=parseInt(h.eq(a).parents(".item").find(".xiaoJi").html()),f.html(m))}}),p("#list_active").on("click",".btn_add",function(e){var t=p.cookie("cart"),i=JSON.parse(t),n=p(this).siblings().children(":first"),c=n.parents(".c_amount").siblings(".c_product").find(".cn"),o=n.parents(".c_amount").siblings(".c_cheaper").find(".xiaoJi"),r=n.val();r++;for(var a=0;a<i.length;a++)if(i[a].name==c.html()){i[a].num=r,o.html(i[a].price*i[a].num),n.val(i[a].num);break}var l=JSON.stringify(i);p.cookie("cart",l);var s=p("#list_active").find(".item"),h=p("#list_active").find(".btn_ckBox");for(a=m=0;a<s.length;a++)h.eq(a).prop("checked")&&(m+=parseInt(h.eq(a).parents(".item").find(".xiaoJi").html()),f.html(m))});p("#list_active").find(".item");var u=p("#list_active").find(".btn_ckBox");p("#list_active").on("change",".btn_ckBox",function(e){for(var t=m=0;t<u.length;t++)u.eq(t).prop("checked")?m+=parseInt(u.eq(t).parents(".item").find(".xiaoJi").html()):m+=0,f.html(m)}),p(".list_footer").on("change",".text_checkALL",function(){if(p(this).prop("checked"))for(var e=m=0;e<u.length;e++)m+=parseInt(u.eq(e).parents(".item").find(".xiaoJi").html()),f.html(m);else m=0,f.html(m)}),p("#list_active").on("click",".btn_del",function(e){for(var t=p.cookie("cart"),i=JSON.parse(t),n=p(this).parents(".item"),c=n.find(".cn").html(),o=0;o<i.length;o++)if(i[o].name==c){i.splice(o,1);break}var r=JSON.stringify(i);p.cookie("cart",r,{path:"/",expires:3}),n.remove()});var g=p(".text_checkALL"),b=p("#list_active").find(".btn_ckBox"),x=b.length;g.change(function(){g.prop("checked")?b.prop("checked",!0):(x=0,b.prop("checked",!1))});for(var y=0;y<b.length;y++)b.eq(y).change(function(){g.prop("checked",!0)&&(p(this).prop("checked")?x++:x--,x===b.length?g.prop("checked",!0):g.prop("checked",!1))})})});